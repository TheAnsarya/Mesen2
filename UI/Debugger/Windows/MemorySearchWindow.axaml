<Window
	xmlns="https://github.com/avaloniaui"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:m="clr-namespace:Nexen"
	xmlns:vm="using:Nexen.Debugger.ViewModels"
	xmlns:sys="using:System"
	xmlns:v="using:Nexen.Views"
	xmlns:dbg="using:Nexen.Debugger"
	xmlns:c="using:Nexen.Controls"
	xmlns:l="using:Nexen.Localization"
	xmlns:i="using:Nexen.Interop"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:dvm="using:Nexen.Debugger.ViewModels"
	xmlns:dc="using:Nexen.Debugger.Controls"
	xmlns:ext="using:Nexen.Controls.DataGridExtensions"
	mc:Ignorable="d" d:DesignWidth="700" d:DesignHeight="500"
	x:Class="Nexen.Debugger.Windows.MemorySearchWindow"
	Icon="/Assets/Find.png"
	Width="700" Height="500"
	x:DataType="vm:MemorySearchViewModel"
	Title="{l:Translate wndTitle}"
>
	<Design.DataContext>
		<vm:MemorySearchViewModel />
	</Design.DataContext>

	<Window.Styles>
		<Style Selector="CheckBox.isNotMatch">
			<Setter Property="Background" Value="LightCoral" />
		</Style>
	</Window.Styles>
	
	<DockPanel>
		<DockPanel DockPanel.Dock="Right" Margin="3">
			<c:ButtonWithIcon
				Icon="Assets/Refresh.png"
				DockPanel.Dock="Bottom"
				HorizontalAlignment="Right"
				Text="{l:Translate btnResetCounters}"
				Command="{Binding ResetCounters}"
		  />
			
			<StackPanel>
				<Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto">
					<TextBlock Text="{l:Translate lblMemType}" />
					<c:EnumComboBox
						Grid.Column="1"
						SelectedItem="{Binding MemoryType}"
						AvailableValues="{Binding AvailableMemoryTypes}"
						MinWidth="120"
				  />

					<TextBlock Grid.Row="1" Text="{l:Translate lblFormat}" />
					<c:EnumComboBox Grid.Column="1" Grid.Row="1" SelectedItem="{Binding Format}" />

					<TextBlock Grid.Row="2" Text="{l:Translate lblValueSize}" />
					<c:EnumComboBox Grid.Column="1" Grid.Row="2" SelectedItem="{Binding ValueSize}" />
				</Grid>

				<c:OptionSection Header="{l:Translate lblSearchFilter}">
					<c:GroupBox Header="{l:Translate lblCompareTo}">
						<Grid ColumnDefinitions="Auto,5,*" RowDefinitions="Auto,Auto,Auto,Auto">
							<c:EnumRadioButton
								Grid.ColumnSpan="3"
								Value="{Binding CompareTo}"
								CheckedWhen="{x:Static dvm:MemorySearchCompareTo.PreviousSearchValue}"
							/>
							<c:EnumRadioButton
								Grid.ColumnSpan="3"
								Grid.Row="1"
								Value="{Binding CompareTo}"
								CheckedWhen="{x:Static dvm:MemorySearchCompareTo.PreviousRefreshValue}"
							/>
							<c:EnumRadioButton
								Grid.Row="2"
								Value="{Binding CompareTo}"
								CheckedWhen="{x:Static dvm:MemorySearchCompareTo.SpecificValue}"
							/>
							<c:NexenNumericTextBox
								Grid.Row="2"
								Grid.Column="2"
								IsEnabled="{Binding IsSpecificValueEnabled}"
								Value="{Binding SpecificValue}"
								MinWidth="60"
								Min="{Binding MinValue}"
								Max="{Binding MaxValue}"
								Hex="{Binding IsValueHex}"
							/>
							<c:EnumRadioButton
								Grid.Row="3"
								Value="{Binding CompareTo}"
								CheckedWhen="{x:Static dvm:MemorySearchCompareTo.SpecificAddress}"
							/>
							<c:NexenNumericTextBox
								Grid.Row="3"
								Grid.Column="2"
								IsEnabled="{Binding IsSpecificAddressEnabled}"
								Value="{Binding SpecificAddress}"
								Hex="True"
								MinWidth="60"
								Min="0"
								Max="{Binding MaxAddress}"
							/>
						</Grid>
					</c:GroupBox>
					<c:GroupBox Header="{l:Translate lblOperator}">
						<StackPanel>
							<c:EnumRadioButton 
								Value="{Binding Operator}"
								CheckedWhen="{x:Static dvm:MemorySearchOperator.Equal}"
							/>
							<c:EnumRadioButton
								Value="{Binding Operator}"
								CheckedWhen="{x:Static dvm:MemorySearchOperator.NotEqual}"
							/>
							<c:EnumRadioButton
								Value="{Binding Operator}"
								CheckedWhen="{x:Static dvm:MemorySearchOperator.LessThan}"
							/>
							<c:EnumRadioButton
								Value="{Binding Operator}"
								CheckedWhen="{x:Static dvm:MemorySearchOperator.LessThanOrEqual}"
							/>
							<c:EnumRadioButton
								Value="{Binding Operator}"
								CheckedWhen="{x:Static dvm:MemorySearchOperator.GreaterThan}"
							/>
							<c:EnumRadioButton
								Value="{Binding Operator}"
								CheckedWhen="{x:Static dvm:MemorySearchOperator.GreaterThanOrEqual}"
							/>
						</StackPanel>
					</c:GroupBox>
				
					<DockPanel>
						<c:ButtonWithIcon
							Icon="Assets/Find.png"
							DockPanel.Dock="Left"
							HorizontalAlignment="Right"
							VerticalAlignment="Top"
							Text="{l:Translate btnApplyFilter}"
							Command="{Binding AddFilter}"
						/>
						<StackPanel>
							<c:ButtonWithIcon
								Icon="Assets/Undo.png"
								HorizontalAlignment="Right"
								Text="{l:Translate btnUndo}"
								IsEnabled="{Binding IsUndoEnabled}"
								Command="{Binding Undo}"
							/>
							<c:ButtonWithIcon
								Icon="Assets/Close.png"
								HorizontalAlignment="Right"
								Text="{l:Translate btnReset}"
								Command="{Binding ResetSearch}"
							/>
						</StackPanel>
					</DockPanel>
				</c:OptionSection>
			</StackPanel>
		</DockPanel>

		<Border BorderBrush="Gray" BorderThickness="1">
			<DataGrid
				ItemsSource="{Binding ListData}"
				SelectedItem="{Binding Selection.SelectedItem}"
				IsReadOnly="True"
				CanUserReorderColumns="False"
				HeadersVisibility="Column"
				GridLinesVisibility="All"
				ext:DataGridSortBehavior.SortState="{Binding SortState}"
				ext:DataGridSortBehavior.SortMode="Multiple"
				ext:DataGridSortBehavior.SortCommand="{Binding SortCommand}"
				ext:DataGridColumnWidthBehavior.ColumnWidths="{Binding ColumnWidths}"
			>
				<DataGrid.Columns>
					<DataGridTextColumn SortMemberPath="Address" Header="{l:Translate colAddress}" Binding="{Binding AddressString, DataType={x:Type dvm:MemoryAddressViewModel}}" CanUserResize="True" IsReadOnly="True" />
					<DataGridTextColumn SortMemberPath="Value" Header="{l:Translate colValue}" Binding="{Binding Value, DataType={x:Type dvm:MemoryAddressViewModel}}" CanUserResize="True" IsReadOnly="True" />
					<DataGridTextColumn SortMemberPath="PrevValue" Header="{l:Translate colPrevValue}" Binding="{Binding PrevValue, DataType={x:Type dvm:MemoryAddressViewModel}}" CanUserResize="True" IsReadOnly="True" />
					<DataGridTextColumn SortMemberPath="ReadCount" Header="{l:Translate colReadCount}" Binding="{Binding ReadCount, DataType={x:Type dvm:MemoryAddressViewModel}}" CanUserResize="True" IsReadOnly="True" />
					<DataGridTextColumn SortMemberPath="LastRead" Header="{l:Translate colLastRead}" Binding="{Binding LastRead, DataType={x:Type dvm:MemoryAddressViewModel}}" CanUserResize="True" IsReadOnly="True" />
					<DataGridTextColumn SortMemberPath="WriteCount" Header="{l:Translate colWriteCount}" Binding="{Binding WriteCount, DataType={x:Type dvm:MemoryAddressViewModel}}" CanUserResize="True" IsReadOnly="True" />
					<DataGridTextColumn SortMemberPath="LastWrite" Header="{l:Translate colLastWrite}" Binding="{Binding LastWrite, DataType={x:Type dvm:MemoryAddressViewModel}}" CanUserResize="True" IsReadOnly="True" />
					<DataGridTextColumn SortMemberPath="ExecCount" Header="{l:Translate colExecCount}" Binding="{Binding ExecCount, DataType={x:Type dvm:MemoryAddressViewModel}}" CanUserResize="True" IsReadOnly="True" />
					<DataGridTextColumn SortMemberPath="LastExec" Header="{l:Translate colLastExec}" Binding="{Binding LastExec, DataType={x:Type dvm:MemoryAddressViewModel}}" CanUserResize="True" IsReadOnly="True" />
					<DataGridTemplateColumn
						SortMemberPath="Match"
						CanUserSort="False"
						Header="{l:Translate colMatch}"
						Width="22"
					>
						<DataTemplate>
							<CheckBox IsChecked="{Binding IsMatch, DataType={x:Type dvm:MemoryAddressViewModel}}" IsHitTestVisible="False" Classes.isNotMatch="{Binding !IsMatch, DataType={x:Type dvm:MemoryAddressViewModel}}" />
						</DataTemplate>
					</DataGridTemplateColumn>
				</DataGrid.Columns>
			</DataGrid>
		</Border>
	</DockPanel>
</Window>
